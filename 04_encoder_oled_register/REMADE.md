<!--
 * @Descripttion: 
 * @Author: JaRyon
 * @version: 
 * @Date: 2025-09-21 11:45:26
-->
# STM32F103C8T6 旋转编码器 OLED 显示

## 一、项目概述

基于STM32F103C8T6微控制器，实现使用旋转编码器控制OLED屏幕上显示的数值。

**核心功能：**

- 使用STM32的定时器编码器模式，高精度读取编码器状态
- OLED屏幕实时显示编码器的**累计计数值**、**当前角度**和**旋转圈数**
- 正转时，数值增加
- 反转时，数值减少

**实验现象:**

<img src="C:\Users\xf\OneDrive\Desktop\encoder3.jpg" alt="encoder3" style="zoom:50%;" />

<img src="C:\Users\xf\OneDrive\Desktop\encoder1.jpg" alt="encoder1" style="zoom:50%;" />

<img src="C:\Users\xf\OneDrive\Desktop\encoder2.jpg" alt="encoder2" style="zoom:50%;" />

------

## 二、硬件平台

- **主控芯片**：STM32F103C8T6
- **输入设备**：360°旋转编码器 (带A/B相输出)
- **显示设备**：0.96寸 I2C 通信 SSD1306 OLED屏幕
- **烧录工具**：ST-Link V2

## 三、开发环境

- **主开发IDE**：Keil MDK
- **辅助编辑器**：VSCode
- **开发语言**：C语言 (基于寄存器直接操作)

## 四、硬件接线说明

| 外设模块       | 引脚连接 (STM32F103C8T6)                  | 接线细节                                                     |
| :------------- | :---------------------------------------- | :----------------------------------------------------------- |
| **旋转编码器** | A相 → PA6<br>B相 → PA7<br>GND/VCC → GND/VCC | A、B相分别连接到PA6和PA7，编码器VCC和GND引脚接GND或VCC。按键(C)未使用。 |
| **SSD1306 OLED** | SCL → PA0<br>SDA → PA1<br>VCC → 3.3V<br>GND → GND | OLED的I2C时钟和数据线连接到PA0和PA1。务必确保VCC和GND与单片机正确连接。 |
| **ST-Link V2** | SWDIO, SWCLK, GND, 3.3V                   | 严格对应引脚连接，为单片机提供调试和烧录接口。               |

**⚠️ 特别注意：**
- 所有外设的GND必须与STM32的GND连接在一起（共地）
- OLED屏幕如果使用5V供电，可能会损坏，请确认其工作电压

## 五、工程结构

```plaintext
├── Hardware/
│   ├── delay.c         # 简单的软件延时函数
│   ├── i2c.c           # I2C总线底层驱动
│   ├── encoder.c       # 编码器驱动 (使用TIM3编码器模式)
│   └── tim.c           # 通用定时器配置 (如需要)
├── Interface/
│   └── oled.c          # OLED屏幕驱动 (SSD1306)
└── User/
    ├── includes.h      # 工程全局头文件统一管理
    └── main.c          # 主函数，实现核心逻辑
```

## 六、功能实现说明

### 1. 核心工作原理

- **编码器模式**：使用TIM3的编码器模式3，对A、B相的所有边沿进行采样（四倍频），实现高精度计数。
- **数据处理**：在主循环中，通过读取定时器计数值，计算出编码器的相对变化量，并累加到总计数中。
- **角度与圈数计算**：基于总计数和编码器分辨率，计算出当前角度和旋转圈数。

**注意**：角度和圈数的计算基于一个关键参数：**编码器每转一圈产生80个物理脉冲**。如果你的编码器参数不同，需要修改这个系数以获得准确的角度值。

## 七、烧录与调试步骤

1. **硬件连接**：严格按照“硬件接线说明”连接所有设备。
2. **驱动安装**：在PC端安装ST-Link V2驱动。
3. **工程配置**：在Keil MDK中配置ST-Link调试器。
4. **程序烧录**：编译工程并下载到STM32单片机。
5. **调试验证**：旋转编码器，观察OLED屏幕上的三个数值是否能实时、准确地更新。

## 八、使用说明

1. 系统上电后，OLED屏幕初始化并显示计数值、角度和圈数，初始值均为0。
2. **顺时针旋转**编码器，计数值增加，角度从0°递增，圈数在角度满360°后增加1。
3. **逆时针旋转**编码器，计数值减少，角度从360°递减，圈数在角度从0°再减少时减1。
4. 角度值始终保持在0°到360°之间，圈数可正可负，表示总旋转的圈数和方向。

## 九、版本说明

- **当前版本**：V1.0 
- **版本更新**：基础版，计数、角度和圈数的实时计算与显示功能。
- **版本状态**：已实现核心功能（编码器高精度读取、OLED实时显示计数、角度和圈数）。代码采用模块化设计，结构清晰。

## 十、Keil MDK 特别配置注意事项

使用 OLED 相关代码时，需在 Keil MDK 中进行如下配置，否则可能编译报错：在 Keil MDK 的 `Options for Target` 窗口中，进入 `C/C++` 选项卡，在 `Misc Controls` 中添加字符 `--no-multibyte-chars`。